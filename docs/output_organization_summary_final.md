# å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ•´ç† - æœ€çµ‚å®Ÿè£…ã‚µãƒãƒªãƒ¼

## âœ… å®Ÿè£…å®Œäº†

### ä¸»ãªæ”¹å–„ç‚¹

1. **ä½™åˆ†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å‰Šæ¸›**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒæœ‰åŠ¹ãªå ´åˆã€`detections/`, `floormaps/`, `graphs/`, `labels/`ã‚’ãƒ«ãƒ¼ãƒˆã«ä½œæˆã—ãªã„
   - å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`sessions/`, `archive/`, `shared/`ï¼‰ã®ã¿ä½œæˆ

2. **main.pyã®æœ€é©åŒ–**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒæœ‰åŠ¹ãªå ´åˆã€`setup_output_directories()`ã‚’å‘¼ã°ãªã„
   - ã™ã¹ã¦ã®å‡ºåŠ›ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«æ•´ç†

3. **æ•´ç†ãƒ„ãƒ¼ãƒ«ã®æä¾›**
   - `tools/cleanup_old_outputs.py`ã§æ—¢å­˜ã®å¤ã„å‡ºåŠ›ã‚’æ•´ç†å¯èƒ½

---

## ğŸ“ æœ€çµ‚çš„ãªæ§‹é€ 

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æœ‰åŠ¹æ™‚

```
output/
â”œâ”€â”€ sessions/              # å®Ÿè¡Œã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆmain.pyã®å®Ÿè¡Œçµæœã®ã¿ï¼‰
â”‚   â””â”€â”€ YYYYMMDD_HHMMSS/
â”‚       â”œâ”€â”€ metadata.json
â”‚       â”œâ”€â”€ summary.json
â”‚       â””â”€â”€ phase*/
â”œâ”€â”€ latest -> sessions/...
â”œâ”€â”€ archive/
â”œâ”€â”€ shared/
â””â”€â”€ system.log
```

**ä½œæˆã•ã‚Œãªã„ã‚‚ã®:**
- `detections/` âŒ
- `floormaps/` âŒ
- `graphs/` âŒ
- `labels/` âŒï¼ˆ`shared/labels/`ã¯ä½œæˆã•ã‚Œã‚‹ï¼‰

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ç„¡åŠ¹æ™‚ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

```
output/
â”œâ”€â”€ detections/
â”œâ”€â”€ floormaps/
â”œâ”€â”€ graphs/
â”œâ”€â”€ labels/
â””â”€â”€ system.log
```

---

## ğŸ”§ å®Ÿè£…ã®å¤‰æ›´

### main.py

```python
# ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒæœ‰åŠ¹ãªå ´åˆ
if use_session_management:
    # setup_output_directories()ã‚’å‘¼ã°ãªã„
    output_manager = OutputManager(output_path)
    session_dir = output_manager.create_session()
    output_path = session_dir
else:
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒç„¡åŠ¹ãªå ´åˆã®ã¿å¾“æ¥ã®æ§‹é€ ã‚’ä½œæˆ
    setup_output_directories(output_path)
```

### OutputManager

- `_setup_directories()`ã§æœ€å°é™ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿ä½œæˆ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã«å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`sessions/`, `archive/`, `shared/`ï¼‰ã®ã¿

---

## ğŸ§¹ æ—¢å­˜ã®å¤ã„å‡ºåŠ›ã®æ•´ç†

### æ•´ç†ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨

```bash
# DRY RUNãƒ¢ãƒ¼ãƒ‰ï¼ˆç¢ºèªã®ã¿ï¼‰
python tools/cleanup_old_outputs.py

# å®Ÿéš›ã«å‰Šé™¤
python tools/cleanup_old_outputs.py --execute
```

### æ¤œå‡ºã•ã‚Œã‚‹é …ç›®

- **ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `coordinate_transformations.json`, `detection_statistics.json`, `zone_counts.csv`, `timestamp_extraction_*.csv`
- **ç©ºã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `floormaps/`, `graphs/`
- **å†…å®¹ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `detections/`ï¼ˆæ‰‹å‹•ç¢ºèªãŒå¿…è¦ï¼‰

---

## âœ… ç¢ºèªäº‹é …

- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒæœ‰åŠ¹ãªå ´åˆã€ä½™åˆ†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œãªã„
- [x] ã™ã¹ã¦ã®å‡ºåŠ›ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«æ•´ç†ã•ã‚Œã‚‹
- [x] å¾Œæ–¹äº’æ›æ€§ãŒä¿ãŸã‚Œã‚‹ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ç„¡åŠ¹æ™‚ï¼‰
- [x] æ•´ç†ãƒ„ãƒ¼ãƒ«ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹

---

## ğŸ“Š æ”¹å–„åŠ¹æœ

### æ”¹å–„å‰

- ãƒ«ãƒ¼ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ•£åœ¨ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- ç©ºã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæ®‹ã‚‹ï¼ˆ2ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
- å®Ÿè¡Œã”ã¨ã®åŒºåˆ¥ãŒã§ããªã„

### æ”¹å–„å¾Œ

- ãƒ«ãƒ¼ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ•£åœ¨ã—ãªã„
- å®Ÿè¡Œã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³
- ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã«æ•´ç†
- æœ€å°é™ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **æ—¢å­˜ã®å¤ã„å‡ºåŠ›ã‚’æ•´ç†**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   ```bash
   python tools/cleanup_old_outputs.py --execute
   ```

2. **æ–°ã—ã„å®Ÿè¡Œã§ç¢ºèª**
   ```bash
   python main.py
   # output/sessions/YYYYMMDD_HHMMSS/ ã«ã™ã¹ã¦ã®å‡ºåŠ›ãŒæ•´ç†ã•ã‚Œã‚‹
   ```

3. **å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®è¨­å®š**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   ```bash
   # cronã§å®šæœŸå®Ÿè¡Œ
   0 3 * * * cd /path/to/project && python tools/cleanup_output.py --archive
   ```

