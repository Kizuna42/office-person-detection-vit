# P2-施策 7: 外れ値検知の強化

## 優先度

**P2（中長期対応: 1 ヶ月以内）**

## 目的

異常なタイムスタンプを早期検出し、データの品質を向上させる。

## 問題背景

- フレームサンプラーでは ±120 秒以内の差を許容（`frame_sampler.py:780`）
- 日付レベルの誤認識（24 日間）は検出できない
- **コード箇所**: `src/video/frame_sampler.py:763-785`

## 実装内容

### 1. 統計的検定による外れ値検知

- フレーム間の時間差の統計的検定（Z-score、IQR 法）
- 異常な時間差の検出
- 外れ値の自動除外または警告

### 2. 日付レベルの外れ値検知

- ±1 日以上の差を警告
- 日付の不連続性の検出
- 日付の妥当性チェック（月、日の範囲）

### 3. 自動補間と手動確認のハイブリッド

- 外れ値が検出された場合、自動補間を試行
- 補間が困難な場合は手動確認を推奨
- 補間結果の品質評価

## 期待効果

**精度向上: 10-20%**

## 実装ファイル

- `src/video/frame_sampler.py:763-785`
  - 新規メソッド: `_detect_outliers_with_statistics()`
  - 新規メソッド: `_detect_date_level_outliers()`
  - 新規メソッド: `_interpolate_outliers()`
  - `_scan_all_timestamps()`メソッドの修正

## 実装工数

**2-3 日**

## 検証方法

- 外れ値検知の精度を測定
- 統計的検定の効果を評価
- 自動補間の精度を確認

## 成功基準

- 外れ値検知の精度 ≥ 90%
- 統計的検定の精度 ≥ 95%
- 自動補間の精度 ≥ 85%

## 関連施策

- 施策 2: 時系列補正ロジックの厳格化（P0、連携必要）
- 施策 8: タイムスタンプ専用モデルの検討（P2、後続）
