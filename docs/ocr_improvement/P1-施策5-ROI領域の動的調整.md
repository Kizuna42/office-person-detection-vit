# P1-施策 5: ROI 領域の動的調整

## 優先度

**P1（重要対応: 1-2 週間以内）**

## 目的

フレームブレに対応し、ROI 領域を動的に調整する。

## 問題背景

- ROI 座標が固定（`900, 30, 360, 45`）
- フレームブレや解像度不足でタイムスタンプ領域が不完全に抽出される可能性
- **コード箇所**: `src/timestamp/timestamp_extractor.py:53`

## 実装内容

### 1. ROI 領域のテンプレートマッチング

- タイムスタンプ領域のテンプレートを作成
- テンプレートマッチングで位置を自動検出
- マッチングスコアに基づく品質評価

### 2. 複数の ROI 候補領域の試行

- 右上、左上など複数の候補領域を試行
- 各候補領域で OCR を実行
- 最高信頼度の結果を選択

### 3. ROI 領域の品質評価

- コントラスト、エッジ密度の評価
- 品質が低い場合は警告
- 品質に応じた前処理の調整

## 期待効果

**精度向上: 15-30%**

## 実装ファイル

- `src/timestamp/timestamp_extractor.py`（新規メソッド追加）
  - 新規メソッド: `_detect_roi_with_template_matching()`
  - 新規メソッド: `_try_multiple_roi_candidates()`
  - 新規メソッド: `_evaluate_roi_quality()`
  - `extract()`メソッドの修正

## 実装工数

**2-3 日**

## 検証方法

- ROI 領域の検出精度を測定
- 複数候補領域の試行効果を評価
- 品質評価の精度を確認

## 成功基準

- ROI 領域の検出精度 ≥ 95%
- 複数候補領域の試行による精度向上 ≥ 15%
- 品質評価の精度 ≥ 90%

## 関連施策

- 施策 4: 前処理パラメータの最適化（P1、並行実施可能）
- 施策 6: 複数 OCR エンジンのアンサンブル強化（P1、後続）
