# P0-施策 2: 時系列補正ロジックの厳格化

## 優先度

**P0（緊急対応: 即座に実施）**

## 目的

誤認識の継続を防止し、時系列の整合性を厳格にチェックする。

## 問題背景

- ±12 時間以内の日付跨ぎは許容（`timestamp_extractor.py:772-791`）
- 3 年以上の差は破棄するが、それ以下の差は許容（`timestamp_extractor.py:766-770`）
- 24 日間（8/02 → 8/26）の差は許容範囲内と判定される可能性
- 補正ロジックが緩すぎて、誤認識を正しく検出できない

## 実装内容

### 1. 日付レベルの外れ値検知

- 前回フレームとの差が ±1 日以上の場合、警告・再検証
- 日付が変更された場合の特別処理
- 異常な日付変化の検出

### 2. 警告ログの強化

- 3 年以上の差だけでなく、±7 日以上の差も警告ログを出力
- 警告レベルに応じた処理（警告のみ、再検証、破棄）
- ログに詳細な情報を記録（前回値、現在値、差）

### 3. 補正前の複数フレーム検証

- 補正前に前後 3 フレームの多数決で検証
- 複数フレームで一致する結果のみ採用
- 不一致の場合は警告して手動確認を推奨

## 期待効果

**精度向上: 40-60%**

## 実装ファイル

- `src/timestamp/timestamp_extractor.py:763-791`
  - `parse_timestamp()`メソッドの修正
  - 新規メソッド: `_detect_date_outlier()`
  - 新規メソッド: `_validate_with_neighbor_frames()`

## 実装工数

**1-2 日**

## 検証方法

- 時系列補正の妥当性を検証
- 日付レベルの外れ値検知の精度を測定
- 警告ログの出力状況を確認

## 成功基準

- 日付レベルの外れ値検知率 ≥ 90%
- 誤認識の継続率 ≤ 10%
- 警告ログの適切な出力

## 関連施策

- 施策 1: 最初のフレーム検証と再試行メカニズム（連携必要）
- 施策 7: 外れ値検知の強化（P2、後続）
