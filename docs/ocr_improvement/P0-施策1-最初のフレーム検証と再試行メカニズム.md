# P0-施策 1: 最初のフレーム検証と再試行メカニズム

## 優先度

**P0（緊急対応: 即座に実施）**

## 目的

最初のフレームでの誤認識を防止し、初期タイムスタンプの精度を向上させる。

## 問題背景

- フレーム 0 で日付が誤認識（2025/08/26 → 2025/08/02）
- `_last_timestamp`が最初のフレームの結果で初期化される
- 時系列補正ロジック（`parse_timestamp`）が履歴を参照して補正するため、誤認識が継続
- **コード箇所**: `src/timestamp/timestamp_extractor.py:649-794`

## 実装内容

### 1. 最初の N フレームでの多数決

- 最初の N フレーム（例: 0-10）で OCR を実行
- 各フレームのタイムスタンプを抽出
- 多数決で初期タイムスタンプを決定
- 信頼度が低い結果は除外

### 2. 初期タイムスタンプの妥当性チェック

- 現在時刻 ±30 日以内のチェック
- 日付の妥当性チェック（月: 1-12、日: 1-31、年: 2000-2100）
- 異常値の検出と警告

### 3. 複数 OCR エンジンでのアンサンブル

- Tesseract、PaddleOCR、EasyOCR で並列実行
- 各エンジンの結果を重み付き投票
- 信頼度に基づく重み付け

## 期待効果

**精度向上: 60-80%**

## 実装ファイル

- `src/timestamp/timestamp_extractor.py`
  - 新規メソッド: `_validate_initial_timestamp()`
  - 新規メソッド: `_extract_initial_timestamp_with_consensus()`
  - `extract()`メソッドの修正

## 実装工数

**2-3 日**

## 検証方法

- 最初の 10 フレームでのタイムスタンプ抽出精度を測定
- 日付誤認識の発生率を記録
- 複数エンジンでのアンサンブル効果を評価

## 成功基準

- 最初のフレームでの日付誤認識率 ≤ 5%
- 初期タイムスタンプの妥当性チェック成功率 ≥ 95%

## 関連施策

- 施策 2: 時系列補正ロジックの厳格化（連携必要）
- 施策 3: 日付部分の独立検証（連携可能）
