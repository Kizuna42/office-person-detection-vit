# OCR 精度評価レポート

**評価日**: 2025-11-06
**評価ツール**: `tools/video_timestamp_analyzer.py`, `tools/timestamp_score_evaluator.py`  
**評価対象**: `input/merged_moviefiles.mov`

## 入力データ仕様

### 動画の基本情報

- **動画の種類**: タイムラプス動画
- **解像度**: 1280×720
- **フレームレート**: 30.00 FPS
- **総フレーム数**: 23,941 フレーム
- **動画の長さ**: 約 13 分 18 秒（798.03 秒）

### 撮影期間（タイムスタンプ）

- **開始時刻**: 2025/08/26 16:04:16
- **終了時刻**: 2025/08/29 13:45:39
- **実際の撮影期間**: 約 2 日 21 時間 41 分 23 秒（約 250,085 秒）

### タイムラプス動画の特性

- **動画の長さ**: 798.03 秒（約 13 分 18 秒）
- **実際の撮影期間**: 250,085 秒（約 2 日 21 時間 41 分 23 秒）
- **時間圧縮率**: 約 313.4 倍（実際の時間 / 動画の長さ）
- **1 フレームあたりの実際の時間**: 約 10.4 秒/フレーム（250,085 秒 / 23,941 フレーム）

**注意**: タイムラプス動画であるため、動画の長さ（798.03 秒）と実際の撮影期間（250,085 秒）は異なります。OCR 読み取り結果は、実際の撮影期間と比較する必要があります。

---

## エグゼクティブサマリー

### 総合評価: ❌ **不合格**

**総合スコア**: 31.28/100（目標: ≥80）

| 評価指標                 | 結果       | 目標    | 評価                            | 重要度       |
| ------------------------ | ---------- | ------- | ------------------------------- | ------------ |
| **抽出成功率**           | **87.50%** | ≥ 90%   | ⚠️ **要改善**（-2.5 ポイント）  | 高           |
| **時系列整合性スコア**   | **0.00%**  | ≥ 80%   | ❌ **不合格**（-80 ポイント）   | **極めて高** |
| **平均信頼度**           | **0.2048** | ≥ 0.8   | ❌ **不合格**（-0.60 ポイント） | 高           |
| **開始・終了時刻の精度** | **0 秒**   | ≤ 60 秒 | ✅ **合格**（完全一致）         | **極めて高** |

### 主要な問題点

1. **時系列整合性の完全な欠如**: 期待範囲内ペア数 0/64（0.00%）
2. **信頼度 0.00 の結果の大量発生**: 最後のフレーム群で 90%（9/10 フレーム）
3. **中間フレームでの誤認識継続**: フレーム 23931-23939 で誤認識（2025/08/02 09:13:44）が継続
4. **平均信頼度の低さ**: 0.2048（目標: ≥0.8）

**注意**: 開始・終了時刻は正しく認識されていますが、中間フレームでの誤認識により、時系列整合性が完全に欠如しています。

---

## 詳細評価結果

### 1. 抽出成功率

#### 評価結果

- **抽出成功率**: 87.50%（70/80 フレーム）
- **抽出失敗数**: 12.50%（10/80 フレーム）
- **評価**: ⚠️ **要改善**（目標: ≥90%）

#### 詳細分析

**最初のフレーム群（0-9）**:

- ✅ 抽出成功率: **90.0%**（9/10 フレーム）
- ✅ 正しいタイムスタンプ: **100.0%**（抽出成功したフレーム）
- ✅ 平均信頼度: **0.746**（良好）

**最後のフレーム群（23931-23940）**:

- ❌ 抽出成功率: **100.0%**（10/10 フレーム、タイムスタンプは抽出されている）
- ❌ 正しいタイムスタンプ: **10.0%**（1/10 フレーム）
- ❌ 誤認識率: **90.0%**（9/10 フレーム）
- ❌ 信頼度 0.00 の結果: **90.0%**（9/10 フレーム）

#### 問題点

- 最後のフレーム群で誤認識が継続（2025/08/02 09:13:44）
- 信頼度 0.00 の結果が大量に採用されている
- 抽出は成功しているが、内容が誤っている（抽出失敗より深刻）

---

### 2. 時系列整合性スコア

#### 評価結果

- **整合性スコア**: **0.00%**（期待範囲内ペア数: 0/64）
- **有効ペア数**: 64
- **期待範囲**: 8.0-12.0 秒（10 秒間隔の許容誤差）
- **評価**: ❌ **不合格**（目標: ≥80%）

**注意**: タイムラプス動画であるため、フレーム間の実際の時間差は約 10.4 秒/フレーム（250,085 秒 / 23,941 フレーム）です。評価ツールは 10 秒間隔でフレームを抽出しているため、期待範囲（8.0-12.0 秒）は適切です。

#### 詳細分析

**時間差統計**:

- **平均時間差**: 450,551.70 秒（約 125.2 時間）
- **最小時間差**: 49.00 秒
- **最大時間差**: 2,299,580.00 秒（約 26.6 日）
- **期待値**: 10.00 秒（10 秒間隔での抽出を想定）
- **誤差率**: 約 **45,055 倍**（平均時間差 / 期待値）

**実際の撮影期間を考慮した期待値**:

- **1 フレームあたりの実際の時間**: 約 10.4 秒/フレーム
- **10 秒間隔での抽出時の期待時間差**: 約 10.4 秒 × 3 ≈ 31.2 秒（タイムラプス動画の特性を考慮）
- **しかし、評価ツールは 10 秒間隔で抽出**: 期待範囲（8.0-12.0 秒）は適切

#### 問題点

- **時系列整合性が完全に欠如**: 期待範囲内のペアが 0 件
- **極端な時間差**: 最大で約 26.6 日の誤差
- **日付レベルの誤認識**: 8/02 と 8/26-29 の混在
- **中間フレームの誤認識**: フレーム 23931-23939 で誤認識（2025/08/02 09:13:44）が継続し、時系列が破綻

#### 時系列整合性の内訳

| 時間差範囲              | ペア数 | 割合   | 評価 |
| ----------------------- | ------ | ------ | ---- |
| 8.0-12.0 秒（期待範囲） | 0      | 0.00%  | ❌   |
| 0-60 秒                 | 1      | 1.56%  | ⚠️   |
| 60-3600 秒（1 時間）    | 0      | 0.00%  | ❌   |
| 3600-86400 秒（1 日）   | 0      | 0.00%  | ❌   |
| 86400 秒以上（1 日超）  | 63     | 98.44% | ❌   |

---

### 3. 信頼度統計

#### 評価結果

- **平均信頼度**: **0.2048**（目標: ≥0.8）
- **最小信頼度**: **0.0000**
- **最大信頼度**: **0.9504**
- **評価**: ❌ **不合格**（目標: ≥0.8）

#### 詳細分析

**信頼度分布**:

- **信頼度 0.00**: 約 30-40%（推定、最後のフレーム群で 90%）
- **信頼度 0.0-0.3**: 約 50-60%（推定）
- **信頼度 0.3-0.7**: 約 20-30%（推定）
- **信頼度 ≥0.7**: 約 10-20%（推定）

**最初のフレーム群の信頼度**:

- 平均: 0.746（良好）
- 範囲: 0.50-0.93
- 評価: ✅ **良好**

**最後のフレーム群の信頼度**:

- 平均: 0.054（極めて低い、9/10 が 0.00）
- 範囲: 0.00-0.54
- 評価: ❌ **極めて不良**

#### 問題点

- **信頼度 0.00 の結果が大量に採用**: 最後のフレーム群で 90%
- **平均信頼度が極めて低い**: 0.2048（目標の 25.6%）
- **信頼度によるフィルタリングが不足**: 0.00 の結果が除外されていない

---

### 4. OCR 読み取り結果と実際の撮影期間の比較

#### 評価結果

- **実際の撮影期間**: 250,085 秒（約 2 日 21 時間 41 分 23 秒）
  - 開始: 2025/08/26 16:04:16
  - 終了: 2025/08/29 13:45:39
- **OCR 読み取り結果（開始・終了）**: 250,085 秒（約 2 日 21 時間 41 分 23 秒）
  - 開始: 2025/08/26 16:04:16 ✅ **正しい**
  - 終了: 2025/08/29 13:45:39 ✅ **正しい**（最後のフレームのみ）
- **開始・終了時刻の誤差**: **0 秒** ✅ **完全一致**
- **評価**: ✅ **開始・終了時刻は正しい**

#### 詳細分析

**開始時刻**:

- **OCR 読み取り**: 2025/08/26 16:04:16 ✅ **正しい**
- **実際の撮影開始時刻**: 2025/08/26 16:04:16 ✅ **完全一致**

**終了時刻**:

- **OCR 読み取り**: 2025/08/29 13:45:39 ✅ **正しい**（最後のフレームのみ）
- **実際の撮影終了時刻**: 2025/08/29 13:45:39 ✅ **完全一致**

**問題点**:

- ✅ **開始・終了時刻は正しく認識されている**
- ❌ **中間フレーム（23931-23939）で誤認識が発生**: 2025/08/02 09:13:44（信頼度 0.00）
- ❌ **時系列整合性が完全に欠如**: 中間フレームの誤認識により、フレーム間の時間差が異常な値になっている
- ⚠️ **動画の長さ（798.03 秒）と実際の撮影期間（250,085 秒）の違い**: タイムラプス動画であるため、これは正常な特性であり、誤差ではない

#### タイムラプス動画の特性を考慮した評価

- **動画の長さ**: 798.03 秒（約 13 分 18 秒）← これは動画ファイルの長さ
- **実際の撮影期間**: 250,085 秒（約 2 日 21 時間 41 分 23 秒）← これはタイムスタンプから計算した実際の時間
- **時間圧縮率**: 約 313.4 倍（実際の時間 / 動画の長さ）

**評価基準の見直し**:

- ✅ **開始・終了時刻の精度**: 完全一致（誤差 0 秒）
- ❌ **中間フレームの精度**: 極めて低い（90%が誤認識）
- ❌ **時系列整合性**: 完全に欠如（期待範囲内ペア数 0/64）

---

## 問題の根本原因分析

### 1. 最後のフレーム群での誤認識継続（最重要）

**影響度**: 極めて高い（★★★★★）

**問題**:

- フレーム 23931-23939 で誤認識（2025/08/02 09:13:44）が継続
- 信頼度 0.00 の結果が 90%（9/10 フレーム）で採用されている
- 時系列補正ロジックが最後のフレーム群で正しく機能していない

**根拠**:

- 最初のフレーム検証（施策 1）は効果があるが、最後のフレーム群には適用されていない
- 信頼度 0.00 の結果を除外するロジックが不足
- `_last_timestamp`が誤認識された結果で更新されている可能性

### 2. 信頼度 0.00 の結果の除外不足

**影響度**: 極めて高い（★★★★★）

**問題**:

- 信頼度 0.00 の結果が大量に採用されている
- 信頼度閾値によるフィルタリングが不足
- 信頼度が低い結果でも、時系列補正ロジックが適用されてしまう

**根拠**:

- 最後のフレーム群で信頼度 0.00 の結果が 90%
- 平均信頼度が 0.2048 と極めて低い
- 信頼度によるフィルタリングロジックが実装されていない

### 3. 時系列補正の不完全性

**影響度**: 高い（★★★★☆）

**問題**:

- ±7 日以上の差を除外するロジックは実装済みだが、最後のフレーム群では効果が限定的
- `_last_timestamp`の更新ロジックが不適切
- 信頼度が低い結果でも、`_last_timestamp`が更新されてしまう

**根拠**:

- 時系列整合性スコアが 0.00%
- 最大時間差が約 26.6 日
- 日付レベルの誤認識（8/02 と 8/26-29）が混在

---

## 改善施策の効果評価

### 実装済み施策の効果

| 施策                             | 実装状況 | 効果                                                                                | 評価 |
| -------------------------------- | -------- | ----------------------------------------------------------------------------------- | ---- |
| **施策 1: 最初のフレーム検証**   | ✅ 完了  | ✅ **効果あり**（最初のフレームは正しく認識）                                       | ✅   |
| **施策 2: 時系列補正厳格化**     | ✅ 完了  | ⚠️ **部分的に効果あり**（最後のフレーム群では効果が限定的）                         | ⚠️   |
| **施策 3: 日付独立検証**         | ✅ 完了  | ❓ **効果不明**（評価データ不足）                                                   | ❓   |
| **施策 4: 前処理最適化**         | ✅ 完了  | ❓ **効果不明**（評価データ不足）                                                   | ❓   |
| **施策 5: ROI 動的調整**         | ✅ 完了  | ❓ **効果不明**（評価データ不足）                                                   | ❓   |
| **施策 6: OCR アンサンブル強化** | ✅ 完了  | ⚠️ **部分的に効果あり**（最初のフレームでは効果あり、最後のフレーム群では効果なし） | ⚠️   |

### 未実装施策の必要性

| 施策                              | 優先度 | 必要性       | 期待効果 |
| --------------------------------- | ------ | ------------ | -------- |
| **施策 9: 最後のフレーム検証**    | P0     | **極めて高** | 70-85%   |
| **施策 10: 信頼度フィルタリング** | P0     | **極めて高** | 30-50%   |
| **施策 11: 時系列補正改善**       | P0     | **高**       | 40-60%   |

---

## 推奨される改善アクション

### 即座に実施すべき施策（P0）

1. **施策 9: 最後のフレーム検証と再試行メカニズム**（最優先）

   - 最後の N フレームでの多数決
   - 信頼度 0.00 の結果を除外
   - 時系列整合性チェック

2. **施策 10: 信頼度閾値による結果フィルタリング**（高優先度）

   - 信頼度 0.00 の結果を自動除外
   - 信頼度閾値（0.3）以下の結果を警告ログに記録
   - 信頼度が低い場合の再試行

3. **施策 11: 時系列補正の改善**（高優先度）
   - `_last_timestamp`更新前の再チェック
   - 信頼度による更新制御
   - 更新履歴の保持

### 期待される改善効果

- **施策 9-11 実施後**: 精度向上 85-95%（誤認識率 → 5-15%）
- **時系列整合性スコア**: 0.00% → 70-90%
- **平均信頼度**: 0.2048 → 0.6-0.8
- **OCR 動画長の誤差**: 250,084.97 秒 → ≤60 秒

---

## 評価方法の詳細

### 評価ツール

1. **`tools/video_timestamp_analyzer.py`**

   - 最初と最後の 10 フレームからタイムスタンプを抽出
   - OCR 読み取り結果とメタデータを比較
   - 動画長の誤差を計算

2. **`tools/timestamp_score_evaluator.py`**
   - 10 秒間隔で 100 フレームを抽出（実際は 80 フレーム）
   - 抽出成功率と時系列整合性スコアを算出
   - 信頼度統計を計算

### 評価指標の定義

- **抽出成功率**: タイムスタンプが抽出されたフレームの割合
- **時系列整合性スコア**: 期待範囲内（8.0-12.0 秒）のペアの割合
- **平均信頼度**: 抽出成功したフレームの信頼度の平均
- **開始・終了時刻の精度**: OCR 読み取り結果と実際の撮影期間の開始・終了時刻の差

**注意**: タイムラプス動画であるため、動画の長さ（798.03 秒）と実際の撮影期間（250,085 秒）は異なります。評価は実際の撮影期間に基づいて行います。

---

## 結論

### 評価サマリー

**開始・終了時刻の精度**: ✅ **完全一致**（誤差 0 秒）

- 開始時刻: 2025/08/26 16:04:16 ✅ 正しい
- 終了時刻: 2025/08/29 13:45:39 ✅ 正しい

**中間フレームの精度**: ❌ **極めて低い**

- 時系列整合性スコア: 0.00%（期待範囲内ペア数 0/64）
- 中間フレーム（23931-23939）で誤認識が継続（90%）
- 信頼度 0.00 の結果が大量に採用されている

### 総合評価

現状の OCR 精度は、**開始・終了時刻は正しく認識されているが、中間フレームでの誤認識により、時系列整合性が完全に欠如している**状態です。特に、信頼度 0.00 の結果の大量発生は、システムの根本的な問題を示しています。

**即座に実施すべき施策**:

1. 施策 9: 最後のフレーム検証と再試行メカニズム
2. 施策 10: 信頼度閾値による結果フィルタリング
3. 施策 11: 時系列補正の改善

これらの施策を実施することで、中間フレームの精度を大幅に改善し、時系列整合性を回復できると期待されます。

---

**レポート作成日**: 2025-11-06  
**次回評価予定日**: 施策 9-11 実装後
