# P1-施策4: 前処理パラメータの最適化

## 優先度
**P1（重要対応: 1-2週間以内）**

## 目的
OCR認識率の向上のため、前処理パラメータを最適化する。

## 問題背景
- CLAHE、リサイズ、二値化のパラメータが固定値
- 照明条件やフレーム品質に応じた適応処理が不足
- **コード箇所**: `src/detection/preprocessing.py:284-360`
- **現状設定**: 
  - CLAHE: `clip_limit=2.0, tile_grid_size=(8,8)`
  - リサイズ: `fx=2.0`
  - 二値化: Otsu法

## 実装内容

### 1. グリッドサーチまたはベイズ最適化
- 最適パラメータを探索するための最適化手法を実装
- グリッドサーチ: パラメータの組み合わせを網羅的に探索
- ベイズ最適化: 効率的に最適パラメータを探索（推奨）

### 2. フレーム品質に応じた適応的前処理
- コントラスト、明るさの自動調整
- フレーム品質の評価指標（コントラスト、シャープネス、ノイズレベル）
- 品質に応じた前処理パイプラインの選択

### 3. 複数の前処理パイプラインの試行
- 複数の前処理パイプラインを試行
- 各パイプラインの結果を比較
- 最高信頼度の結果を選択

## 期待効果
**精度向上: 20-40%**

## 実装ファイル
- `src/detection/preprocessing.py`
  - 新規メソッド: `_evaluate_frame_quality()`
  - 新規メソッド: `_select_optimal_pipeline()`
  - `apply_pipeline()`メソッドの拡張
- `tools/run_timestamp_experiment.py`
  - 最適化スクリプトの追加

## 実装工数
**3-5日**

## 検証方法
- 最適化前後の認識率を比較
- フレーム品質に応じた適応処理の効果を評価
- 複数パイプラインの試行効果を測定

## 成功基準
- 認識率の向上 ≥ 20%
- フレーム品質評価の精度 ≥ 90%
- 処理時間の増加 ≤ 50%

## 関連施策
- 施策1: 最初のフレーム検証と再試行メカニズム（連携可能）
- 施策5: ROI領域の動的調整（P1、並行実施可能）

