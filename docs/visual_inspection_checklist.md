# 目視確認ガイド

## ✅ 自動テスト結果

すべての自動テストが成功しました（7/7）。

## 👀 目視確認が必要な項目

### 1. エクスポートされた画像と動画

**場所**: `output/test_export_comprehensive/`

**確認項目**:
- `trajectory_frame_*.png`: 各フレームの軌跡画像
  - 軌跡線が正しく描画されているか
  - Track IDが正しく表示されているか
  - 色分けが適切か

- `test_trajectories.mp4`: 軌跡のアニメーション動画
  - 動画が正常に再生できるか
  - 軌跡が時間とともに更新されているか
  - アニメーションがスムーズか

**確認方法**:
```bash
# 画像を確認
open output/test_export_comprehensive/trajectory_frame_*.png

# 動画を確認
open output/test_export_comprehensive/test_trajectories.mp4
```

### 2. Streamlitインタラクティブ可視化ツール

**起動方法**:
```bash
streamlit run tools/interactive_visualizer.py
```

**確認項目**:
- [ ] ブラウザが自動的に開く（`http://localhost:8501`）
- [ ] サイドバーにセッション選択がある
- [ ] フロアマップ上に軌跡が表示される
- [ ] フレームスライダーで時間を移動できる
- [ ] IDフィルタが機能する
- [ ] 統計情報が正しく表示される

**操作方法**:
1. サイドバーでセッションを選択
2. 「軌跡を表示」「IDを表示」をチェック
3. フレームスライダーを動かして軌跡の変化を確認
4. IDフィルタで特定のトラックのみ表示

### 3. 目視確認ツール（Visual Inspection Tool）

**使用方法**:
```bash
# 追跡結果の可視化
python tools/visual_inspection.py \
    --mode tracking \
    --session output/sessions/<session_id> \
    --output output/visualization \
    --config config.yaml
```

**確認項目**:
- [ ] コマンドが正常に実行される
- [ ] 出力画像が生成される
- [ ] 軌跡が正しく描画されている
- [ ] 色分けが適切か

**注意**: 実際のセッションディレクトリが必要です。

### 4. CSV/JSONファイルの内容確認

**CSVファイル**: `output/test_export_comprehensive/test_trajectories.csv`

**確認項目**:
- [ ] ヘッダー行が正しい（track_id, frame_index, timestamp, x, y, zone_ids, confidence）
- [ ] データ行が正しく記録されている
- [ ] Track IDが連番になっている
- [ ] 座標値が正しい

**JSONファイル**: `output/test_export_comprehensive/test_trajectories.json`

**確認項目**:
- [ ] JSON形式が正しい（構文エラーがない）
- [ ] メタデータが正しい（トラック数、総軌跡点数）
- [ ] 各トラックのデータが正しい

**確認方法**:
```bash
# CSVを確認
head -20 output/test_export_comprehensive/test_trajectories.csv

# JSONを確認（整形）
cat output/test_export_comprehensive/test_trajectories.json | python -m json.tool | head -50
```

## 📊 テスト結果の詳細

### 1. 追跡機能
- ✅ トラッカーの初期化
- ✅ 単一検出結果での追跡
- ✅ 複数フレームでの追跡（IDの維持）
- ✅ 複数オブジェクトの追跡
- ✅ トラック情報の取得

**確認済み**:
- Track IDが正しく割り当てられる
- 複数フレームで同じIDが維持される
- 複数のオブジェクトが正しく追跡される

### 2. カメラキャリブレーション
- ✅ キャリブレーターの初期化
- ✅ パラメータ取得メソッド

**注意**: 実際のキャリブレーションにはチェスボード画像が必要です。

### 3. 座標変換
- ✅ 基本的な座標変換
- ✅ バッチ変換
- ✅ 歪み補正付き座標変換
- ✅ 画像の歪み補正

**確認済み**:
- 座標変換が正しく動作する
- 原点オフセットが適用される
- 歪み補正が機能する

### 4. 再投影誤差評価
- ✅ 評価器の初期化
- ✅ ホモグラフィ変換の精度評価
- ✅ 誤差マップの生成

**確認済み**:
- 誤差が正しく計算される
- 誤差マップが生成される

### 5. エクスポート機能
- ✅ CSV形式でエクスポート
- ✅ JSON形式でエクスポート
- ✅ 画像シーケンスでエクスポート
- ✅ 動画形式でエクスポート

**確認済み**:
- すべての形式でファイルが生成される
- ファイルサイズが適切

### 6. MOTメトリクス評価
- ✅ MOTメトリクス評価器の初期化
- ✅ MOTメトリクスの計算
- ✅ 個別メトリクスの計算

**確認済み**:
- MOTA、IDF1、ID Switchesが計算される
- 値が0.0-1.0の範囲内

### 7. 統合テスト
- ✅ 追跡 → 座標変換の連携
- ✅ 追跡 → エクスポートの連携

**確認済み**:
- 複数機能が正しく連携する

## 🎯 次のステップ

1. **目視確認を実施**
   - 上記の項目を確認してください

2. **実際のデータでテスト**
   - 実際の動画データを使用
   - チェスボード画像でキャリブレーション
   - 実際の検出結果で追跡

3. **パラメータの調整**
   - Trackerのパラメータ（max_age, min_hits, iou_threshold）
   - ホモグラフィ行列の更新
   - カメラパラメータの設定

4. **精度の改善**
   - 再投影誤差を最小化
   - MOTメトリクスを改善
   - 追跡精度を向上

## 📝 確認チェックリスト

- [ ] エクスポートされた画像を確認
- [ ] エクスポートされた動画を確認
- [ ] Streamlitアプリを起動して確認
- [ ] CSVファイルの内容を確認
- [ ] JSONファイルの内容を確認
- [ ] 目視確認ツールを実行（実際のセッションデータがある場合）

すべて確認できたら、実装は完了です！
