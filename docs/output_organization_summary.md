# å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç† - å®Ÿè£…ã‚µãƒãƒªãƒ¼

## ğŸ“‹ æ¦‚è¦

å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†ã«ã‚ˆã‚Šã€å®Ÿè¡Œã”ã¨ã®å‡ºåŠ›ã‚’æ•´ç†ã—ã€æ¤œç´¢ãƒ»ç®¡ç†ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ¯ ä¸»ãªæ”¹å–„ç‚¹

### 1. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†**
- å„å®Ÿè¡Œã‚’ç‹¬ç«‹ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ç®¡ç†
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
- å®Ÿè¡Œå±¥æ­´ã®è¿½è·¡ãŒå¯èƒ½

### 2. **éšå±¤çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ **
- ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã«æ•´ç†ï¼ˆPhase 1-5ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—åˆ¥ã«åˆ†é¡
- æ¤œç´¢ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãŒå®¹æ˜“

### 3. **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
- å¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ã®æœ€é©åŒ–
- é‡è¦ãªçµæœã®ä¿è­·

---

## ğŸ“ æ–°ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
output/
â”œâ”€â”€ sessions/                          # å®Ÿè¡Œã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â””â”€â”€ 20251107_023001/              # å®Ÿè¡Œæ—¥æ™‚ (YYYYMMDD_HHMMSS)
â”‚       â”œâ”€â”€ metadata.json              # å®Ÿè¡Œãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”‚       â”œâ”€â”€ summary.json               # å®Ÿè¡Œã‚µãƒãƒªãƒ¼
â”‚       â”œâ”€â”€ phase1_extraction/         # ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º
â”‚       â”œâ”€â”€ phase2_detection/          # ãƒ•ã‚§ãƒ¼ã‚º2: äººç‰©æ¤œå‡º
â”‚       â”œâ”€â”€ phase3_transform/          # ãƒ•ã‚§ãƒ¼ã‚º3: åº§æ¨™å¤‰æ›
â”‚       â”œâ”€â”€ phase4_aggregation/        # ãƒ•ã‚§ãƒ¼ã‚º4: é›†è¨ˆ
â”‚       â”œâ”€â”€ phase5_visualization/      # ãƒ•ã‚§ãƒ¼ã‚º5: å¯è¦–åŒ–
â”‚       â””â”€â”€ logs/                      # ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ­ã‚°
â”‚
â”œâ”€â”€ latest/                            # æœ€æ–°å®Ÿè¡Œçµæœã¸ã®ãƒªãƒ³ã‚¯
â”œâ”€â”€ archive/                           # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆ30æ—¥ä»¥ä¸Šå¤ã„ï¼‰
â””â”€â”€ shared/                            # å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨

```python
from pathlib import Path
from src.utils import OutputManager

# OutputManagerã‚’åˆæœŸåŒ–
output_base = Path("output")
manager = OutputManager(output_base)

# æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
session_dir = manager.create_session()

# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
manager.save_metadata(session_dir, config_dict, args_dict)

# ã‚µãƒãƒªãƒ¼ã‚’ä¿å­˜
manager.save_summary(session_dir, summary_dict)

# æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ã®ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
manager.update_latest_link(session_dir)
```

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ„ãƒ¼ãƒ«

```bash
# ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’è¡¨ç¤º
python tools/cleanup_output.py --list

# çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
python tools/cleanup_output.py --stats

# 30æ—¥ä»¥ä¸Šå¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
python tools/cleanup_output.py --archive --archive-days 30

# 90æ—¥ä»¥ä¸Šå¤ã„ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’å‰Šé™¤
python tools/cleanup_output.py --delete-archives --delete-archive-days 90

# ç‰¹å®šã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
python tools/cleanup_output.py --session 20251107_023001

# ç‰¹å®šã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
python tools/cleanup_output.py --session 20251107_023001 --delete
```

---

## ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

### æ–°è¦ä½œæˆ

1. **`src/utils/output_manager.py`**
   - `OutputManager`ã‚¯ãƒ©ã‚¹
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½
   - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½

2. **`tools/cleanup_output.py`**
   - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ„ãƒ¼ãƒ«
   - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

3. **`docs/output_organization_best_practices.md`**
   - ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
   - è©³ç´°ãªè¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### æ›´æ–°

1. **`src/utils/__init__.py`**
   - `OutputManager`ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

2. **`src/utils/output_utils.py`**
   - å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ—¢å­˜é–¢æ•°ã‚’ä¿æŒ

---

## ğŸ”„ ç§»è¡Œæ‰‹é †

### æ—¢å­˜å‡ºåŠ›ã®ç§»è¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

æ—¢å­˜ã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãã®ã¾ã¾æ®‹ã—ã€æ–°ã—ã„å®Ÿè¡Œã‹ã‚‰æ–°ã—ã„æ§‹é€ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

å¿…è¦ã«å¿œã˜ã¦ã€æ—¢å­˜ã®å‡ºåŠ›ã‚’æ‰‹å‹•ã§æ•´ç†ï¼š

```bash
# æ—¢å­˜ã®å‡ºåŠ›ã‚’ç¢ºèª
ls -la output/

# å¿…è¦ã«å¿œã˜ã¦æ‰‹å‹•ã§æ•´ç†
mkdir -p output/sessions/legacy
# æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•
```

---

## âœ… æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. main.pyã®çµ±åˆ

`main.py`ã§`OutputManager`ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ›´æ–°ï¼š

```python
from src.utils import OutputManager

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚’æœ‰åŠ¹åŒ–
output_manager = OutputManager(output_path)
session_dir = output_manager.create_session()

# å„ãƒ•ã‚§ãƒ¼ã‚ºã®å‡ºåŠ›ã‚’session_diré…ä¸‹ã«ä¿å­˜
# ...
```

### 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

`config.yaml`ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®è¨­å®šã‚’è¿½åŠ ï¼š

```yaml
output:
  directory: "output"
  use_session_management: true  # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚’æœ‰åŠ¹åŒ–
  archive_days: 30              # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¯¾è±¡ã®æ—¥æ•°
  delete_archive_days: 90      # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‰Šé™¤å¯¾è±¡ã®æ—¥æ•°
```

### 3. å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®è¨­å®š

cronã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã§å®šæœŸå®Ÿè¡Œï¼š

```bash
# æ¯æ—¥åˆå‰3æ™‚ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†ã‚’å®Ÿè¡Œ
0 3 * * * cd /path/to/project && python tools/cleanup_output.py --archive
```

---

## ğŸ“š å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **è©³ç´°ã‚¬ã‚¤ãƒ‰**: `docs/output_organization_best_practices.md`
- **å®Ÿè£…ã‚³ãƒ¼ãƒ‰**: `src/utils/output_manager.py`
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ„ãƒ¼ãƒ«**: `tools/cleanup_output.py`

---

## ğŸ’¡ ãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆ

1. **æ•´ç†ã•ã‚ŒãŸå‡ºåŠ›**: å®Ÿè¡Œã”ã¨ã«æ•´ç†ã•ã‚Œã€æ¤œç´¢ãŒå®¹æ˜“
2. **å±¥æ­´ç®¡ç†**: éå»ã®å®Ÿè¡Œçµæœã‚’è¿½è·¡å¯èƒ½
3. **ãƒ‡ã‚£ã‚¹ã‚¯åŠ¹ç‡**: è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æœ€é©åŒ–
4. **å†ç¾æ€§**: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚Šå®Ÿè¡Œæ¡ä»¶ã‚’å†ç¾å¯èƒ½
5. **ãƒ‡ãƒãƒƒã‚°**: ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ­ã‚°ã§å•é¡Œè¿½è·¡ãŒå®¹æ˜“

